# ===== CONFIGURAÇÃO DO SERVIÇO DE DUBLAGEM E CLONAGEM DE VOZ =====
# Copie este arquivo para .env e ajuste os valores conforme necessário
# Engine: XTTS (Coqui TTS)

# ===== APLICAÇÃO =====
APP_NAME=Audio Voice Service
VERSION=2.0.0
ENVIRONMENT=development  # development, staging, production
DEBUG=false

# ===== SERVIDOR =====
HOST=0.0.0.0
DIVISOR=5
PORT=800${DIVISOR}

# ===== LOW VRAM MODE =====
# Ativa modo de baixo consumo de VRAM (GPUs com 4-6GB)
# true: Carrega modelos sob demanda, libera VRAM após uso (70-75% economia)
# false: Mantém modelos carregados na VRAM (melhor performance)
LOW_VRAM=true

# ===== REDIS =====
# Para Docker Compose: redis://redis:6379/5
# Para desenvolvimento local: redis://localhost:6379/5
# Para Redis remoto: redis://usuario:senha@host:porta/db
REDIS_URL=redis://192.168.18.110:6379/${DIVISOR}

# ===== CELERY =====
CELERY_BROKER_URL=${REDIS_URL}  # Usa mesma URL do Redis
CELERY_RESULT_BACKEND=${REDIS_URL}  # Usa mesma URL do Redis
CELERY_TASK_TIME_LIMIT=1800  # 30 minutos máximo por task
CELERY_TASK_SOFT_TIME_LIMIT=1600  # 26.6 minutos soft limit
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=50

# ===== CACHE =====
CACHE_TTL_HOURS=24
CACHE_CLEANUP_INTERVAL_MINUTES=30
CACHE_MAX_SIZE_MB=2048
VOICE_PROFILE_TTL_DAYS=30

# ===== LIMITES DE PROCESSAMENTO =====
MAX_FILE_SIZE_MB=100  # Tamanho máximo do arquivo (1-500MB)
MAX_DURATION_MINUTES=60  # Duração máxima do áudio (1-60 minutos)
MAX_TEXT_LENGTH=10000  # Máximo de caracteres para dublagem
MAX_CONCURRENT_JOBS=3
JOB_TIMEOUT_MINUTES=15

# ===== XTTS (Coqui TTS - ÚNICO ENGINE) =====
XTTS_MODEL=tts_models/multilingual/multi-dataset/xtts_v2
XTTS_DEVICE=cuda  # cuda ou cpu (auto-detect se vazio)
XTTS_FALLBACK_CPU=true  # Fallback para CPU se CUDA não disponível
XTTS_TEMPERATURE=0.75
XTTS_REPETITION_PENALTY=1.5
XTTS_LENGTH_PENALTY=1.2
XTTS_TOP_K=60
XTTS_TOP_P=0.9
XTTS_SPEED=1.0
XTTS_TEXT_SPLITTING=true
XTTS_SAMPLE_RATE=24000
XTTS_MAX_TEXT_LENGTH=5000
XTTS_MIN_REF_DURATION=3
XTTS_MAX_REF_DURATION=30

# ===== RESILIÊNCIA =====
MAX_RETRIES=3
RETRY_DELAY_SECONDS=5
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60
TASK_TIMEOUT_SECONDS=300

# ===== DIRETÓRIOS =====
UPLOAD_DIR=./uploads
PROCESSED_DIR=./processed
TEMP_DIR=./temp
VOICE_PROFILES_DIR=./voice_profiles
MODELS_DIR=./models
LOG_DIR=./logs

# ===== LOGGING =====
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json ou text
LOG_ROTATION=1 day
LOG_RETENTION=30 days

# ===== FFMPEG =====
FFMPEG_THREADS=0  # 0 = auto
FFMPEG_AUDIO_CODEC=pcm_s16le  # Codec ideal para processamento

# ===== TREINAMENTO XTTS =====
# Configurações para fine-tuning do modelo XTTS
# Estas variáveis são opcionais - se não definidas, usa valores padrão

# MAX_TRAIN_SAMPLES: Limita quantidade de amostras por época
# - Vazio ou não definido = dataset completo (4429 samples)
# - 100 = teste rápido (útil para debug)
# - 1000 = treinamento médio
MAX_TRAIN_SAMPLES=

# NUM_EPOCHS: Quantidade de épocas de treinamento
# - Padrão: 1000 (se não definido)
NUM_EPOCHS=1000

# LOG_EVERY_N_STEPS: Frequência de logging durante treinamento
# - Padrão: 10 (se não definido)
# - 1 = log a cada step (verbose)
# - 50 = log menos frequente
LOG_EVERY_N_STEPS=10
