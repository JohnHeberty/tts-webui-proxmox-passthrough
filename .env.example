# ===== CONFIGURAÇÃO DO SERVIÇO DE DUBLAGEM E CLONAGEM DE VOZ (Multi-Engine) =====
# Copie este arquivo para .env e ajuste os valores conforme necessário
# Engines disponíveis: XTTS (padrão/estável) e F5-TTS/E2-TTS (experimental/alta qualidade)

# ===== APLICAÇÃO =====
APP_NAME=Audio Voice Service
VERSION=2.0.0
ENVIRONMENT=development  # development, staging, production
DEBUG=false

# ===== SERVIDOR =====
HOST=0.0.0.0
DIVISOR=5
PORT=800${DIVISOR}

# ===== LOW VRAM MODE =====
# Ativa modo de baixo consumo de VRAM (GPUs com 4-6GB)
# true: Carrega modelos sob demanda, libera VRAM após uso (70-75% economia)
# false: Mantém modelos carregados na VRAM (melhor performance)
LOW_VRAM=true

# ===== REDIS =====
# Para Docker Compose: redis://redis:6379/5
# Para desenvolvimento local: redis://localhost:6379/5
# Para Redis remoto: redis://usuario:senha@host:porta/db
REDIS_URL=redis://192.168.18.110:6379/${DIVISOR}

# ===== CELERY =====
CELERY_BROKER_URL=${REDIS_URL}  # Usa mesma URL do Redis
CELERY_RESULT_BACKEND=${REDIS_URL}  # Usa mesma URL do Redis
CELERY_TASK_TIME_LIMIT=1800  # 30 minutos máximo por task
CELERY_TASK_SOFT_TIME_LIMIT=1600  # 26.6 minutos soft limit
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=50

# ===== CACHE =====
CACHE_TTL_HOURS=24
CACHE_CLEANUP_INTERVAL_MINUTES=30
CACHE_MAX_SIZE_MB=2048
VOICE_PROFILE_TTL_DAYS=30

# ===== LIMITES DE PROCESSAMENTO =====
MAX_FILE_SIZE_MB=100  # Tamanho máximo do arquivo (1-500MB)
MAX_DURATION_MINUTES=60  # Duração máxima do áudio (1-60 minutos)
MAX_TEXT_LENGTH=10000  # Máximo de caracteres para dublagem
MAX_CONCURRENT_JOBS=3
JOB_TIMEOUT_MINUTES=15

# ===== XTTS (Coqui TTS - ÚNICO ENGINE) =====
XTTS_MODEL=tts_models/multilingual/multi-dataset/xtts_v2
XTTS_DEVICE=cuda  # cuda ou cpu (auto-detect se vazio)
XTTS_FALLBACK_CPU=true  # Fallback para CPU se CUDA não disponível
XTTS_TEMPERATURE=0.75
XTTS_REPETITION_PENALTY=1.5
XTTS_LENGTH_PENALTY=1.2
XTTS_TOP_K=60
XTTS_TOP_P=0.9
XTTS_SPEED=1.0
XTTS_TEXT_SPLITTING=true
XTTS_SAMPLE_RATE=24000
XTTS_MAX_TEXT_LENGTH=5000
XTTS_MIN_REF_DURATION=3
XTTS_MAX_REF_DURATION=30

# ===== F5-TTS / E2-TTS (Flow Matching Diffusion - EMOTION MODEL) =====
# F5-TTS: Flow Matching TTS com alta expressividade (100+ idiomas)
# E2-TTS: Enhanced F5-TTS com suporte emocional aprimorado
F5TTS_ENABLED=true
F5TTS_MODEL=SWivid/E2-TTS  # SWivid/E2-TTS (emotion) ou SWivid/F5-TTS (base)
F5TTS_DEVICE=cpu  # cpu ou cuda (recomendado: cpu para evitar OOM)
F5TTS_FALLBACK_CPU=true  # Fallback para CPU se CUDA não disponível

# Whisper (Auto-transcription para ref_text)
F5TTS_WHISPER_MODEL=base  # tiny, base, small, medium, large
F5TTS_WHISPER_DEVICE=cpu  # cpu ou cuda

# Quality Profiles (NFE Steps = Neural Flow Estimator iterations)
F5TTS_NFE_STEP_FAST=24      # Fast: ~1min de processamento (qualidade ok)
F5TTS_NFE_STEP_BALANCED=40  # Balanced: ~2min de processamento (boa qualidade)
F5TTS_NFE_STEP_ULTRA=64     # Ultra: ~3min de processamento (máxima qualidade)

# Synthesis Parameters
F5TTS_CFG_STRENGTH=2.0       # Classifier-free guidance (1.0-3.0, maior = mais fiel ao prompt)
F5TTS_SWAY_SAMPLING_COEF=-1.0  # Sway sampling (-1.0 = desabilitado, 0.0-1.0 = ativo)
F5TTS_SPEED=1.0              # Velocidade de fala (0.5-2.0)

# DSP Post-Processing (Hiss Reduction)
F5TTS_DENOISE_STRENGTH=0.85  # Força da redução de chiado (0.0-1.0)
F5TTS_DEESSING_FREQ=7000     # Frequência do de-esser em Hz (6000-8000)
F5TTS_HIGHPASS_FREQ=50       # High-pass filter em Hz (remove rumble)
F5TTS_LOWPASS_FREQ=12000     # Low-pass filter em Hz (remove HF artifacts)

# Audio Constraints
F5TTS_SAMPLE_RATE=24000      # Taxa de amostragem (24kHz fixo)
F5TTS_MIN_REF_DURATION=3     # Duração mínima do áudio de referência (segundos)
F5TTS_MAX_REF_DURATION=30    # Duração máxima do áudio de referência (segundos)
F5TTS_MAX_TEXT_LENGTH=10000  # Máximo de caracteres para síntese

# ===== RESILIÊNCIA =====
MAX_RETRIES=3
RETRY_DELAY_SECONDS=5
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60
TASK_TIMEOUT_SECONDS=300

# ===== DIRETÓRIOS =====
UPLOAD_DIR=./uploads
PROCESSED_DIR=./processed
TEMP_DIR=./temp
VOICE_PROFILES_DIR=./voice_profiles
MODELS_DIR=./models
LOG_DIR=./logs

# ===== LOGGING =====
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json ou text
LOG_ROTATION=1 day
LOG_RETENTION=30 days

# ===== FFMPEG =====
FFMPEG_THREADS=0  # 0 = auto
FFMPEG_AUDIO_CODEC=pcm_s16le  # Codec ideal para processamento
